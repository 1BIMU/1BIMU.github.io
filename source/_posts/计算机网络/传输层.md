---
categories:
  - 计算机
tags:
  - 计算机网络
mathjax: "true"
title: 传输层
date: 2025-05-26 08:09:38
---
# 核心功能  
提供进程到进程的，可靠的，有效的传输服务  
![](/IMG/Pasted%20image%2020250603195032.png)  

## 传输层的主要功能  
- 屏蔽通信子网的多样性，为上层提供通用的接口  
- 利用端口的不同，提供进程到进程的可靠服务  
- 提供有连接的服务和无连接的服务  

## 端口  
传输层主要通过通信的端口来锁定到特定的进程上。  
![](/IMG/Pasted%20image%2020250603205029.png)  
这张图很好的说明了，对于传输层的服务访问点，是通过端口来控制的。对于网络层的服务访问点，是通过主机（IP）来控制的。  

端口的类型主要分为三个，包括：  
- well-known:前0-1023  
- Registered:前1024-49151  
- Dynamic:前49152-65535  

### 端口寻址  
即，如何获得特定process的端口(TSAP)的问题。  
对于比较特殊的服务，比如说邮箱服务器或者web服务器，都留有特定的端口来处理任务。  
对于一般的任务而言，一般交由一个Portmapper来处理，根据client的服务请求将相应的TSAP地址返回给Client。  
进程服务器：如果每个端口服务器都时时刻刻监听访问，未免有些浪费资源。因此启动一个进程服务器来进行监听的代理。为client的请求分配对应的端口。  

## 差错控制  
- ARQ机制，通过检查checksum字段进行错误检查并丢包  
- 每个段都带有对应的序列号，只有收到对应序列号的ACK才正确接收  
- 利用滑动窗口协议防止缓冲区溢出，并实现双工通信  
和数据链路层的不同：传输层提供的是端到端的可靠服务，并且由于数据量大，必须开大窗口，同时重传不可忽略（误码概率相对更高）  

### 缓冲区处理  
对于缓冲区的处理，对于低带宽突发网络，无需预先分配固定缓冲区，而是动态在两端获取缓冲区。而高带宽流量，则需要接收方预先分配完整窗口缓冲区（以便计算最大传输速率）。  

#### 缓冲区类型  
- 链式固定大小缓冲区  
- 链式动态大小缓冲区  
- 每个连接一个大循环缓冲区(用完了之后就会从头覆写)  

## 流量控制  
- **可变大小的发送窗口（A variable-sized sending windows）**  
    - 初始缓冲区协商（Initial buffer negotiating）：在通信开始时，发送方和接收方会协商确定初始的缓冲区大小，这直接影响到发送窗口的大小。  
- **两个流量控制因素（Two flow control factor）**  
    - 接收方可用的缓冲空间（Buffer space available in the receiver）：  
        - 显式窗口指示（explicit window indication）：接收方会明确告知发送方当前可用的缓冲空间大小，即接收窗口的大小。这是流量控制的核心机制之一，确保发送方不会发送超过接收方处理能力的数据量。  
    - 子网容量（The capacity of the subnet）：  
        - 发送方监控网络承载能力（sender monitor the network's carrying capacity）：除了考虑接收方的缓冲空间外，发送方还需要监控整个子网的容量，以避免网络拥塞。这一部分属于拥塞控制（congestion control）的范畴，旨在防止过多的数据涌入网络，导致性能下降或数据丢失。  

## 复用网络层  
![](/IMG/Pasted%20image%2020250604120521.png)  
如图所示，传输层支持在发送端将进程通过一个复用器，把进程的数据整合在一起，发往网络层。  
在接收端，同样也有一个解复用器，可以将数据解析到对应的进程上。  

## 拥塞控制  
回想网络层，由于拥塞发生在路由器上，因此，网络层能检测到拥塞，但是网络层无法控制拥塞。而传输层所能做的，就是在接受到拥塞通知后，尽可能的减缓向网络层发包的速度，以此达到拥塞控制。  
核心目的：  
- **避免拥塞**：这是最基本的目标，确保网络不会因为过多的数据流量而变得无法正常工作。  
- **高效利用带宽**：找到一种好的带宽分配方式，使得所有可用的带宽都能得到充分利用，提高网络效率。  
- **公平性**：在竞争传输实体之间保持公平，确保每个实体都能获得合理的资源份额。  
- **快速收敛**：能够迅速跟踪并适应流量变化，使网络状态尽快达到稳定状态。  

### 功率  
定义：$$power = \frac{load}{delay}$$  
可以这样理解，在给定的时延中，所能承载的负载越大，说明这个网络的效率越高。  
![](/IMG/Pasted%20image%2020250604122420.png)  
如下图所示，灰色部分的斜率较大，因此功率较小，即发生了拥塞。  
网络的最好表现即功率最高的地方。  


# TCP协议  

## 建立连接(三次握手)  
TCP协议提供面向连接的服务，因此在通信之前，必须先建立连接。  
核心目的是：收发双方可以建立一个且只有一个连接。  

### 理解三次握手的必要性  
